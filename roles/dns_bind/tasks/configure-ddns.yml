---
# Configurar DNS DinÃ¡mico (DDNS) usando clave del vault

- name: "ðŸ”‘ Crear clave DDNS desde vault"
  copy:
    content: |
      key "{{ vault_ddns_key_name }}" {
          algorithm {{ vault_ddns_key_algorithm }};
          secret "{{ vault_ddns_key_secret }}";
      };
    dest: /etc/bind/dhcp-key.key
    owner: bind
    group: bind
    mode: '0640'
  become: true

- name: "ðŸ”— Incluir clave TSIG en named.conf"
  lineinfile:
    path: /etc/bind/named.conf
    line: 'include "/etc/bind/dhcp-key.key";'
    insertafter: EOF
    state: present
  become: true
  notify: restart bind9

- name: "âœ… Clave DDNS configurada desde vault"
  debug:
    msg: 
      - "â†’ Clave: {{ vault_ddns_key_name }}"
      - "â†’ Algoritmo: {{ vault_ddns_key_algorithm }}"
      - "â†’ UbicaciÃ³n: /etc/bind/dhcp-key.key"
      - "â†’ Fuente: group_vars/all.vault.yml (centralizada)"
