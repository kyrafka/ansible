---
# Configurar DNS DinÃ¡mico (DDNS) para integraciÃ³n con DHCPv6

- name: "ğŸ”‘ Generar clave TSIG para DDNS"
  command: >
    tsig-keygen -a hmac-sha256 dhcp-key
  register: tsig_key_output
  changed_when: false

- name: "ğŸ“ Guardar clave TSIG en archivo"
  copy:
    content: "{{ tsig_key_output.stdout }}"
    dest: /etc/bind/dhcp-key.key
    owner: bind
    group: bind
    mode: '0640'
  become: true

- name: "ğŸ”— Incluir clave TSIG en named.conf"
  lineinfile:
    path: /etc/bind/named.conf
    line: 'include "/etc/bind/dhcp-key.key";'
    insertafter: EOF
    state: present
  become: true
  notify: restart bind9

- name: "ğŸ“‹ Extraer nombre de la clave"
  set_fact:
    ddns_key_name: "{{ tsig_key_output.stdout | regex_search('key \"([^\"]+)\"', '\\1') | first }}"

- name: "âœ… Clave DDNS generada"
  debug:
    msg: "â†’ Clave: {{ ddns_key_name }}"
