---
# Configurar systemd-resolved para coexistir con BIND9
# systemd-resolved NO escucha en puerto 53, pero sigue funcionando para el sistema

- name: "âš™ï¸  Configurar systemd-resolved para NO usar puerto 53"
  lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    create: yes
  loop:
    - { regexp: '^#?DNSStubListener=', line: 'DNSStubListener=no' }
    - { regexp: '^#?DNS=', line: 'DNS=127.0.0.1 8.8.8.8 8.8.4.4' }
    - { regexp: '^#?FallbackDNS=', line: 'FallbackDNS=1.1.1.1 1.0.0.1' }
    - { regexp: '^#?Domains=', line: 'Domains={{ dns_domain_name }}' }
  notify: restart systemd-resolved

- name: "ğŸ”„ Reiniciar systemd-resolved con nueva configuraciÃ³n"
  systemd:
    name: systemd-resolved
    state: restarted
    daemon_reload: yes

- name: "ğŸ”— Recrear enlace simbÃ³lico de resolv.conf a systemd-resolved"
  file:
    src: /run/systemd/resolve/resolv.conf
    dest: /etc/resolv.conf
    state: link
    force: yes
