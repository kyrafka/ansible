options {
    directory "/var/cache/bind";

    // Configuración de forwarders
    forwarders {
{% for forwarder in dns_forwarders %}
        {{ forwarder }};
{% endfor %}
    };

    // Configuración de seguridad
    dnssec-validation auto;
    
    // Configuración de red
    listen-on-v6 { any; };
    listen-on { any; };
    
    // DNS64: Traduce respuestas IPv4 a IPv6 usando prefijo NAT64
    // NOTA: No crear zonas reversas automáticas
    empty-zones-enable no;
    
    dns64 64:ff9b::/96 {
        clients { any; };
        mapped { !{{ dns_network_ipv6 }}; any; };
        exclude { 64:ff9b::/96; ::ffff:0:0/96; };
        recursive-only yes;
        break-dnssec yes;
    };
    
    // Permitir consultas desde redes locales
    allow-query { 
        localhost; 
        localnets;
        {{ dns_network_ipv6 }};
    };
    
    // Permitir recursión
    recursion yes;
    allow-recursion { 
        localhost; 
        localnets;
        {{ dns_network_ipv6 }};
    };

    // Configuración de transferencias
    allow-transfer { none; };
    
    // Configuración de notificaciones
    notify no;
    
    // Configuración de versión (seguridad)
    version none;
    hostname none;
    server-id none;
    
    // Configuración para zonas dinámicas
    ixfr-from-differences yes;
};

// Configuración de logging
{% if dns_log_queries %}
logging {
    channel query_log {
        file "{{ dns_log_file }}" versions 3 size 5m;
        severity {{ dns_log_level }};
        print-time yes;
        print-category yes;
    };
    
    category queries { query_log; };
    category security { query_log; };
    category lame-servers { null; };
};
{% endif %}