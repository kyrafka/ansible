---
# Configuraci칩n de ClamAV - Antivirus

- name: "Configurar ClamAV"
  template:
    src: clamd.conf.j2
    dest: /etc/clamav/clamd.conf
    backup: yes
    mode: '0644'
  notify: restart clamav-daemon

- name: "Configurar freshclam (actualizador de firmas)"
  template:
    src: freshclam.conf.j2
    dest: /etc/clamav/freshclam.conf
    backup: yes
    mode: '0644'

- name: "Actualizar base de datos de virus"
  command: freshclam --quiet
  changed_when: false
  failed_when: false

- name: "Habilitar y iniciar ClamAV daemon"
  systemd:
    name: clamav-daemon
    enabled: yes
    state: started

- name: "Crear script de escaneo autom치tico"
  template:
    src: clamav-scan.sh.j2
    dest: /usr/local/bin/clamav-scan.sh
    mode: '0755'

- name: "Ejecutar escaneo de prueba"
  command: clamscan --version
  register: clamav_version
  changed_when: false

- name: "Mostrar informaci칩n de ClamAV"
  debug:
    msg: |
      游 ClamAV configurado: {{ clamav_version.stdout }}
      Daemon activo para escaneo en tiempo real
      Actualizaciones autom치ticas de firmas habilitadas
      
      Comandos 칰tiles:
      - clamav-scan.sh (escaneo completo del sistema)
      - clamscan /ruta/archivo (escanear archivo espec칤fico)
      - clamdscan /ruta (escaneo r치pido con daemon)