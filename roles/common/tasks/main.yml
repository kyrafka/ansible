- name: Ensure users exist
  ansible.builtin.user:
    name: "{{ item.name }}"
    state: "{{ item.state }}"
    shell: "{{ item.shell }}"
    groups: "{{ item.groups }}"
    create_home: yes
  loop: "{{ users }}"

- name: Ensure game servers directory exists
  ansible.builtin.file:
    path: "{{ game_servers_dir }}"
    state: directory
    owner: steam_svc
    group: steam_svc
    mode: "0750"

- name: Cron job to restart service using cron_time
  ansible.builtin.cron:
    name: "restart game updater"
    minute: "{{ (cron_time.split()[0]) | default('0') }}"
    hour: "{{ (cron_time.split()[1]) | default('3') }}"
    day: "{{ (cron_time.split()[2]) | default('*') }}"
    month: "{{ (cron_time.split()[3]) | default('*') }}"
    weekday: "{{ (cron_time.split()[4]) | default('*') }}"
    job: "systemctl restart {{ cron_restart_service }}"
