---
# Configuración específica para usuario CLIENTE (gamer01)

- name: Permisos de solo lectura en games para cliente
  ansible.builtin.file:
    path: /srv/games
    owner: root
    group: pcgamers
    mode: '0755'
  become: true

- name: Asegurar que cliente no tenga sudo
  ansible.builtin.file:
    path: /etc/sudoers.d/gamer01
    state: absent
  become: true

- name: Denegar SSH saliente para cliente
  ansible.builtin.blockinfile:
    path: /etc/ssh/ssh_config
    block: |
      Match User gamer01
          PermitOpen none
    create: yes
  become: true

- name: Restringir acceso a carpetas sensibles para cliente
  ansible.builtin.file:
    path: "{{ item }}"
    mode: '0700'
  loop:
    - /srv/admin
    - /srv/audits
  become: true
  ignore_errors: yes

- name: Mensaje de configuración cliente
  ansible.builtin.debug:
    msg:
      - "✅ Usuario CLIENTE (gamer01) configurado"
      - "  - Sin sudo"
      - "  - NO puede SSH al servidor"
      - "  - Solo lectura en /srv/games"
      - "  - Sin acceso a carpetas admin/audits"
