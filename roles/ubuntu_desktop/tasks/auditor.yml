---
# Configuración específica para usuario AUDITOR

- name: Acceso solo lectura a logs para auditor
  ansible.builtin.file:
    path: /var/log
    mode: '0755'
  become: true

- name: Restringir comandos sudo para auditor (solo lectura)
  ansible.builtin.lineinfile:
    path: /etc/sudoers.d/auditor
    line: "auditor ALL=(ALL) NOPASSWD: /usr/bin/cat, /usr/bin/less, /usr/bin/tail, /usr/bin/journalctl, /usr/bin/ls"
    create: true
    mode: '0440'
    validate: 'visudo -cf %s'
  become: true

- name: Permisos solo lectura en /srv/games para auditor
  ansible.builtin.file:
    path: /srv/games
    mode: '0755'
  become: true

- name: Denegar SSH saliente para auditor
  ansible.builtin.blockinfile:
    path: /etc/ssh/ssh_config
    block: |
      Match User auditor
          PermitOpen none
    create: yes
  become: true

- name: Mensaje de configuración auditor
  ansible.builtin.debug:
    msg:
      - "✅ Usuario AUDITOR configurado"
      - "  - Solo lectura de logs"
      - "  - NO puede SSH al servidor"
      - "  - Solo lectura en /srv/games"
