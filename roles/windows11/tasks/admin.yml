---
- name: Crear usuario Administrador
  ansible.windows.win_user:
    name: "{{ windows11_users.admin.username }}"
    password: "{{ windows11_users.admin.password }}"
    state: present
    groups:
      - Administradores
      - Usuarios de escritorio remoto
    password_never_expires: true

- name: Crear carpetas de admin
  ansible.windows.win_file:
    path: "{{ item }}"
    state: directory
  loop:
    - C:\Admin
    - C:\Games
    - C:\Instaladores

- name: Permisos completos en carpetas admin
  ansible.windows.win_acl:
    path: "{{ item }}"
    user: "{{ windows11_users.admin.username }}"
    rights: FullControl
    type: allow
    state: present
  loop:
    - C:\Admin
    - C:\Games
    - C:\Instaladores

- name: Configurar firewall para admin (permitir todo)
  community.windows.win_firewall_rule:
    name: "Admin - {{ item.name }}"
    enabled: true
    state: present
    action: allow
    direction: "{{ item.direction }}"
    protocol: tcp
    localport: "{{ item.port }}"
  loop:
    - { name: 'SSH', port: '22', direction: 'out' }
    - { name: 'HTTP', port: '80', direction: 'out' }
    - { name: 'HTTPS', port: '443', direction: 'out' }
    - { name: 'RDP', port: '3389', direction: 'in' }

- name: Deshabilitar UAC para admin
  ansible.windows.win_regedit:
    path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
    name: EnableLUA
    data: 0
    type: dword

- name: Mensaje de configuración
  ansible.builtin.debug:
    msg:
      - "Configuración ADMIN completada"
      - "Usuario: {{ windows11_users.admin.username }}"
      - "Carpetas: C:\\Admin, C:\\Games, C:\\Instaladores"
      - "Permisos: Acceso total, puede instalar software"
      - "Puede conectar por SSH al servidor"
