---
# Configuraci√≥n de systemd y permisos

- name: Crear directorio tmpfiles.d para DHCPv6
  copy:
    content: |
      d /run/dhcp-server6 0755 dhcpd dhcpd -
    dest: /etc/tmpfiles.d/dhcp-server6.conf
    owner: root
    group: root
    mode: '0644'

- name: Aplicar tmpfiles
  command: systemd-tmpfiles --create
  changed_when: false

- name: Crear directorio override para systemd
  file:
    path: /etc/systemd/system/isc-dhcp-server6.service.d
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Configurar RuntimeDirectory en systemd
  copy:
    content: |
      [Unit]
      After=systemd-tmpfiles-setup.service
      Requires=systemd-tmpfiles-setup.service
      
      [Service]
      RuntimeDirectory=dhcp-server6
      RuntimeDirectoryMode=0755
    dest: /etc/systemd/system/isc-dhcp-server6.service.d/override.conf
    owner: root
    group: root
    mode: '0644'
  notify:
    - reload systemd

- name: Crear directorio para PID de DHCPv6
  file:
    path: /run/dhcp-server6
    state: directory
    owner: dhcpd
    group: dhcpd
    mode: '0755'

- name: Recargar systemd
  systemd:
    daemon_reload: yes

- name: Habilitar y arrancar servicio isc-dhcp-server6
  systemd:
    name: isc-dhcp-server6
    state: started
    enabled: yes
