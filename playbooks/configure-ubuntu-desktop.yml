---
# Playbook para configurar Ubuntu Desktop completo
# Ejecutar desde el servidor hacia la VM

- name: Configurar Ubuntu Desktop
  hosts: ubuntu_desktops
  become: true
  
  vars_files:
    - ../group_vars/all.yml
    - ../group_vars/all.vault.yml
  
  tasks:
    - name: "ğŸ“‹ InformaciÃ³n"
      ansible.builtin.debug:
        msg:
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "ğŸ–¥ï¸  Configurando {{ inventory_hostname }}"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "â†’ IP: {{ ansible_host }}"
          - "â†’ Usuario: {{ ansible_user }}"
    
    - name: "ğŸ”§ Aplicar configuraciÃ³n de Ubuntu Desktop"
      ansible.builtin.include_role:
        name: ubuntu_desktop
      vars:
        vm_role: cliente
    
    - name: "ğŸ“¦ Instalar NFS client"
      ansible.builtin.apt:
        name: nfs-common
        state: present
    
    - name: "ğŸ“ Crear punto de montaje NFS"
      ansible.builtin.file:
        path: /mnt/games
        state: directory
        mode: '0755'
    
    - name: "ğŸ”— Configurar montaje NFS automÃ¡tico"
      ansible.builtin.lineinfile:
        path: /etc/fstab
        line: "[2025:db8:10::2]:/srv/games /mnt/games nfs defaults,_netdev 0 0"
        state: present
        backup: yes
    
    - name: "ğŸ”„ Montar NFS"
      ansible.builtin.command: mount -a
      changed_when: false
      failed_when: false
    
    - name: "âœ… ConfiguraciÃ³n completada"
      ansible.builtin.debug:
        msg:
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "âœ… {{ inventory_hostname }} configurado"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "â†’ Usuarios creados"
          - "â†’ Permisos configurados"
          - "â†’ NFS montado en /mnt/games"
          - "â†’ Firewall activo"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
