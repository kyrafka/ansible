---
- name: Crear VM Ubuntu Desktop
  hosts: localhost
  connection: local
  gather_facts: false
  
  vars_files:
    - ../group_vars/all.yml
    - ../group_vars/all.vault.yml
  
  vars_prompt:
    - name: vm_name
      prompt: "Nombre de la VM"
      private: false
      default: "ubuntu-desktop"
  
  vars:
    # Recursos fijos
    vm_cpu: 2
    vm_ram: 4096
    vm_disk: 40
    
    # ISO de Ubuntu Desktop
    iso_path: "[datastore1] ubuntu-24.04.3-desktop-amd64.iso"
    network_name: "M_vm's"
  
  tasks:
    - name: "ğŸ–¥ï¸  Crear VM Ubuntu Desktop"
      community.vmware.vmware_guest:
        hostname: "{{ vault_vcenter_hostname }}"
        username: "{{ vault_vcenter_username }}"
        password: "{{ vault_vcenter_password }}"
        port: "{{ vault_vcenter_port }}"
        validate_certs: false
        datacenter: "ha-datacenter"
        folder: "/ha-datacenter/vm"
        name: "{{ vm_name }}"
        state: poweredon
        guest_id: ubuntu64Guest
        
        hardware:
          memory_mb: "{{ vm_ram }}"
          num_cpus: "{{ vm_cpu }}"
          scsi: paravirtual
          boot_firmware: efi
        
        disk:
          - size_gb: "{{ vm_disk }}"
            type: thin
            datastore: "datastore1"
        
        networks:
          - name: "{{ network_name }}"
            device_type: vmxnet3
        
        cdrom:
          - controller_number: 0
            unit_number: 0
            type: iso
            iso_path: "{{ iso_path }}"
            state: present
      
      register: vm_created
    
    - name: "âœ… VM Creada"
      ansible.builtin.debug:
        msg:
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "âœ… VM creada: {{ vm_name }}"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - ""
          - "ğŸ“Š Recursos:"
          - "  CPU: {{ vm_cpu }} cores"
          - "  RAM: {{ vm_ram }} MB"
          - "  Disco: {{ vm_disk }} GB"
          - "  Red: {{ network_name }}"
          - ""
          - "ğŸ“€ ISO: ubuntu-24.04.3-desktop-amd64.iso"
          - ""
          - "ğŸ”§ Siguiente paso:"
          - "  1. Instalar Ubuntu Desktop desde la ISO"
          - "  2. Usuario: administrador / ContraseÃ±a: 123456"
          - "  3. Red: IPv6 Automatic (DHCP)"
          - "  4. Hostname: {{ vm_name }}"
          - ""
          - "ğŸŒ DHCP asignarÃ¡ IP automÃ¡ticamente"
          - "ğŸ” Ver IP: ip -6 addr show | grep 2025"
          - ""
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
